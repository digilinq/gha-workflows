name: Populate project configuration
on:
  workflow_call:
    inputs:
      ref:
        description: 'Which ref to check out'
        type: string
        required: false
    outputs:
      config:
        description: The project configuration
        value: ${{ jobs.config.outputs.config }}
      java-version:
        description: The Java version
        value: ${{ jobs.config.outputs.java-version }}
      maven-version:
        description: The Maven version
        value: ${{ jobs.config.outputs.maven-version }}

jobs:
  config:
    runs-on: ubuntu-latest
    outputs:
      config: ${{ steps.extract-config.outputs.config }}
      java-version: ${{ fromJson(steps.extract-config.outputs.config).java.version }}
      maven-version: ${{ fromJson(steps.extract-config.outputs.config).maven.version }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Extract project configuration
        id: extract-config
        run: |
          echo "config=$(jq -c '.' '.github/project-config.json')" >> "$GITHUB_OUTPUT"

      - name: Convert Key-Value Pairs to JSON
        run: |
          JSON_STRING=$(jq -n \
            --arg k1 "$KEY1" \
            --arg k2 "$KEY2" \
            --arg k3 "$KEY3" \
            '{KEY1: $k1, KEY2: $k2, KEY3: $k3}')
          echo "JSON_STRING=$JSON_STRING" >> $GITHUB_ENV

      - name: Output JSON
        run: echo "$JSON_STRING"


#      - name: Determine effective workflow configuration
#        uses: RoyalAholdDelhaize/tech-nl-github-workflows/.github/actions/effective-config@v1
#        id: effective-config
#
#      - name: Create or update project configuration
#        run: |
#          echo "${{ steps.effective-config.outputs.config }}" > .github/workflows/project-configuration.yaml
#        shell: bash
